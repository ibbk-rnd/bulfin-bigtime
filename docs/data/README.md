# Отворени данни

## Данни за времеви периоди и събития

| Файл                                       | Описание                                                         |
| ------------------------------------------ | ---------------------------------------------------------------- |
| [timeline-gantt.json](timeline-gantt.json) | Данни които се изобразяват в формат на gantt chart               |
| [timeline-area.json](timeline-area.json)   | Данни за периоди от време които се изобразяват на цялата графика |
| [timeline-line.json](timeline-line.json)   | Дати които се изобразяват като вертикална линия                  |
| [value-line.json](value-line.json)         | Данни които се изобразяват като хоризонтална линия               |
| [settings.json](settings.json)             | Общи настройки                                                   |
| [charts.json](charts.json)                 | Нормализиани и обединени статистически данни                     |
| [words-and-data.json](words-and-data.json) | Информация от за данни от публичното пространство                |

## Организация на статистическите данни

Този проект използва данни от различни източници, като НСИ, Инфостат, БНБ, Евростат и други. Всеки източник предоставя данните си по различен начин:

- **като валута** - в евро, в левове;
- **като мерна единица** - милиарди, милиони, хиляди и т.н.;
- **като момент от времето** - година; месец и година; ден, месец и година; тримесечие.

Структурата за организация на данните, която е описана по-долу, е създадена с цел да приведе данните в единен формат, за да се визуализират по коректен начин. Друга цел на долуописаната организация е да запази максимално контекста на оригиналния формат, за да осигури лесна проверка и сверяване с първоизточника.

### Структура

Всяка група от данни се намира в самостоятелна директория.  
Във всяка директория има поддиректория `raw`, в която се съдържат данни в суров вид от източника - CSV, XLS, текстови файлове и скрийншотове.

В директория `raw` се намира и `.json` файл, който съдържа данните в машинно четим формат, както и допълнителна метаинформация, която се използва за хармонизиране на всички данни. Този .json файл е първоизточникът на информацията. Ако искате да промените името на характеристика или да добавите нови данни, трябва да го направите там.

Едно ниво нагоре, извън директорията raw, се намират .json файлове в нормализиран вид. Те са автоматично генерирани и могат да се използват, но не трябва да се редактират директно.

### Процес на нормализация

Скриптът, който извършва конвертиране на данните от различните източници в един унифициран формат, се намира в `scripts/normalizer.js`.

Нормализацията извършва няколко операции:

1. **Унифициране на датата**

- Ако е налична само годината, се добавят месец и ден - 31 декември.
- Ако са налични година и месец, се добавя ден - последният ден за съответния месец.

2. **Унифициране на множителя**  
   Всички стойности се конвертират към единици. Например, ако източникът предоставя данните в милиони, стойностите се умножават по 1 000 000.

3. **Допълнителни изчисления**
   Извършват се допълнителни изчисления като разлика между две последователни стойности

### Обединяване на данните

Всички нормализирани данни се обединяват в файл `charts.json`, който се зарежда в графиката. Обединяването се извършва от скрипта `scripts/compile.js`.

## Как да нормализирате данните

Стартирайте

```bash
npm run data
```

или

```bash
cd public/data/scripts
node compile.js
```

# Въпроси и отговори

**Q: Как да добавя нова линейна графика?**  
**A:**

1. Създайте нова директория в `/data`.
2. Създайте поддиректория `raw` - `/data/my-new-chart/raw`.
3. В `raw` създайте .json файл с данните, които искате да визуализирате. Използвайте някой от наличните файлове за пример.
4. Редактирайте `scripts/compile.js` и добавете името на директорията, която сте създали, и името на .json файла.
5. Стартирайте нормализацията с по-горе описаните команди.
6. Готово.

**Q: Намерих грешка в данните, как мога да я оправя?**  
**A:** Направете pull request с поправените данни или опишете къде е грешката.
